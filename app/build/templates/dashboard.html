{% extends "base.html" %}
{% block title %}Slowfiler : dashboard{% endblock %}

{% block sidebar %}
<li>
  <li>
      <a href="{{url_for('runtest')}}">Run tests</a>
  </li>
</li>
<li>
    <a href="{{url_for('nukedatabase')}}">Delete database</a>
</li>
{% endblock %}


{% block navbar %}
<ul class="navbar-nav mr-auto">
  <li class="nav-item  active">
    <a class="nav-link" href="#">Dashboard <span class="sr-only">(current)</span></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{url_for('compare')}}">Compare <span class="sr-only">(current)</span></a>
  </li>
</ul>
{% endblock %}


{% block main %}

<div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4">Dashboard</h1>
    <p class="lead">Visulizes the most important data of the current build</p>
  </div>
</div>
<div class="col-6">
  <h3> Ram usage between builds.</h3>
  <canvas id="lineram" class="table table-responsive"></canvas>
  <script>
    var ctx = document.getElementById("lineram");
    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: [ {% for build in build_data %}
                "{{build.build_number}}",
              {% endfor %}],
          datasets:[{
              label: 'Average frame time per build',
              data: [
                  {% for build in build_data %}
                    {{ build.build_ramusage }},
                  {% endfor %}
                ],
              borderColor: [
                  'rgba(0,99,132,1)',
                  'rgba(1, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 102, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
              scales: {
                  yAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Time in microsoft'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }],
                  xAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Build number'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }]
              }
          }
    });
  </script>
  </div>
  <div class="col-6">
    <h3> Vram ramUsage.</h3>
    <canvas id="linevram" class="table table-responsive"></canvas>
    <script>
      var ctx = document.getElementById("linevram");
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [ {% for build in build_data %}
                  "{{build.build_number}}",
                {% endfor %}],
            datasets:[{
                label: 'Average frame time per build',
                data: [
                    {% for build in build_data %}
                      {{ build.build_vramusage }},
                    {% endfor %}
                  ],
                borderColor: [
                    'rgba(0,99,132,1)',
                    'rgba(1, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 102, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
                scales: {
                    yAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: 'Time in microsoft'
                      },
                        ticks: {
                            beginAtZero:true
                        }
                    }],
                    xAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: 'Build number'
                      },
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
      });
    </script>
    </div>
  <div class="col-6">
    <h3> The average execution time per tracked function in latest build</h3>
    <canvas id="latestBuildTime" class="table table-responsive"></canvas>
  </div>
  <br/>
  <script>
    var ctx = document.getElementById("latestBuildTime");
    var myChart = new Chart(ctx, {
      type: 'horizontalBar',
      data: {
          labels: [ {% for data in function_data %}
                "{{data.function_name}}",
              {% endfor %}],
          datasets:[{
              label: 'Execution time in microseconds per tracked function',
              data: [
                  {% for data in function_data %}
                    {{ data.avg }},
                  {% endfor %}
                ],

              borderColor: [
                  'rgba(0,99,132,1)',
                  'rgba(1, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 102, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
              scales: {
                  yAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Functioname'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }],

                  xAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Frame time in microsoft'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }]
              }
          }
    });
  </script>
  <table style="width:100%">
 <tr>
   <th>function_name</th>
   <th>avg</th>
   <th>build id</th>
 </tr>
 {% for data in temp %}
 <tr>
   <td>{{data.function_name}}</td>
   <td>{{data.avg}}</td>
   <td>{{data.build}}</td>
 </tr>
 {% endfor %}
</table>
  </div>
{% endblock %}
