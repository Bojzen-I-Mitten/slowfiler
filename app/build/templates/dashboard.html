{% extends "base.html" %}
{% block title %}Slowfiler : dashboard{% endblock %}

{% block sidebar %}
<li>
  <li>
      <a href="{{url_for('runtest')}}">Run tests</a>
  </li>
</li>
<li>
    <a href="{{url_for('nukedatabase')}}">Delete database</a>
</li>
{% endblock %}


{% block navbar %}
<ul class="navbar-nav mr-auto">
  <li class="nav-item  active">
    <a class="nav-link" href="#">Dashboard <span class="sr-only">(current)</span></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{url_for('compare')}}">Compare <span class="sr-only">(current)</span></a>
  </li>
</ul>
{% endblock %}


{% block main %}

<div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4">Dashboard</h1>
    <p class="lead">Visulizes the most important data of the current build</p>
  </div>
</div>



<div class="row">
  <div class="col-6">
    <h3> The performance between builds. Lower is better.</h1>
    <canvas id="lineFrameTime" class="table table-responsive"></canvas>
  </div>
  <script>
    var ctx = document.getElementById("lineFrameTime");
    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: [ {% for build in build_frame_time %}
                "{{build}}",
              {% endfor %}],
          datasets:[{
              label: 'Average frame time per build',
              data: [
                  {% for build in build_frame_time %}
                    {{ build_frame_time[build] }},
                  {% endfor %}
                ],

              borderColor: [
                  'rgba(0,99,132,1)',
                  'rgba(1, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 102, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
              scales: {
                  yAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Time in microsoft'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }],

                  xAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Build number'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }]
              }
          }
    });
  </script>
  <div class="col-6">
    <h3> The average execution time per tracked function in latest build</h1>
    <canvas id="latestBuildTime" class="table table-responsive"></canvas>
  </div>
  <br/>
  <script>
    var ctx = document.getElementById("latestBuildTime");
    var myChart = new Chart(ctx, {
      type: 'horizontalBar',
      data: {
          labels: [ {% for data in last_build %}
                "{{data.name}}",
              {% endfor %}],
          datasets:[{
              label: 'Execution time in microseconds per tracked function',
              data: [
                  {% for build in build_data %}
                    {{ build.samples }},
                  {% endfor %}
                ],

              borderColor: [
                  'rgba(0,99,132,1)',
                  'rgba(1, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 102, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
              scales: {
                  yAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Functioname'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }],

                  xAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Frame time in microsoft'
                    },
                      ticks: {
                          beginAtZero:true
                      }
                  }]
              }
          }
    });
  </script>
  <div class="col-6">
    <h3> Build duration per build</h1>
    <canvas id="latestBuildDuration" class="table table-responsive"></canvas>
    <script>
      var ctx = document.getElementById("latestBuildDuration");
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [ {% for time in build_time %}
                  "{{loop.index}}",
                {% endfor %}],
            datasets:[{
                label: 'Time spent building corresponding build',
                data: [
                    {% for time in build_time %}
                      {{ time }},
                    {% endfor %}
                  ],

                borderColor: [
                    'rgba(0,99,132,1)',
                    'rgba(1, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 102, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
                scales: {
                    yAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: 'Time in microseconds'
                      },
                        ticks: {
                            beginAtZero:true
                        }
                    }],

                    xAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: 'Time in seconds'
                      },
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
      });
    </script>
  </div>
{% endblock %}
